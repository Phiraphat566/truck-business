<div class="flex h-screen bg-gray-100 dark:bg-zinc-950">
  <!-- Sidebar -->
  <aside
    class="w-72 bg-white dark:bg-slate-900 text-gray-800 dark:text-slate-100
           flex flex-col py-8 px-6 rounded-tr-3xl rounded-br-3xl shadow-2xl enhanced-sidebar
           border-r border-gray-100 dark:border-slate-800">

    <!-- Profile -->
    <div
      *ngIf="user$ | async as u; else loadingProfile"
      class="flex flex-col items-center mb-6 profile-section
             cursor-pointer select-none group rounded-2xl p-4
             bg-blue-50/60 dark:bg-slate-800/40 hover:bg-blue-100/70 dark:hover:bg-slate-800
             transition"
      role="button" tabindex="0"
      (click)="goProfile()" (keydown.enter)="goProfile()"
    >
      <div class="relative w-16 h-16 mb-2 mx-auto">
        <!-- แสดงรูปเฉพาะเมื่อมี path และยังไม่ fallback -->
        <ng-container *ngIf="u.profile_image_path && !avatarFallback; else initialsAvatar">
          <img
            [src]="u.profile_image_path"
            (error)="useFallback()"
            alt="Profile"
            class="w-16 h-16 rounded-full object-cover ring-2 ring-blue-400/60 group-hover:ring-blue-500"
            loading="lazy"
          />
        </ng-container>

        <!-- วงกลมตัวอักษร (fallback/ไม่มีรูป) -->
        <ng-template #initialsAvatar>
          <div
            class="w-16 h-16 rounded-full grid place-items-center text-white
                   bg-gradient-to-br from-indigo-500 to-blue-600 text-lg font-semibold"
          >
            {{ initial(u) }}
          </div>
        </ng-template>
      </div>

      <h2 class="text-lg font-semibold">{{ u?.name || u?.username }}</h2>
      <p class="text-sm text-gray-500 dark:text-slate-400">@{{ u?.username }}</p>
    </div>

    <ng-template #loadingProfile>
      <div class="flex flex-col items-center mb-6 animate-pulse">
        <div class="w-16 h-16 rounded-full bg-gray-200 dark:bg-slate-700 mb-2"></div>
        <div class="h-4 w-24 bg-gray-200 dark:bg-slate-700 rounded mb-1"></div>
        <div class="h-3 w-20 bg-gray-200 dark:bg-slate-700 rounded"></div>
      </div>
    </ng-template>

    <div class="border-b border-gray-200 dark:border-slate-800 mb-6"></div>

    <!-- Menu -->
    <nav class="flex-1 flex flex-col gap-1">
      <a
        routerLink="/general" routerLinkActive="active-link"
        class="flex items-center gap-3 px-4 py-2 rounded-lg transition nav-link
               hover:bg-gray-100 dark:hover:bg-slate-800"
        [ngClass]="router.isActive('/general', false)
          ? 'text-blue-600 dark:text-blue-400 font-semibold bg-blue-50 dark:bg-blue-950/30'
          : ''">
        <span class="w-6 flex justify-center"><i class="ni ni-layout-grid text-xl"></i></span>
        <span>General</span>
      </a>

      <a
        routerLink="/time-in-out" routerLinkActive="active-link"
        class="flex items-center gap-3 px-4 py-2 rounded-lg transition nav-link
               hover:bg-gray-100 dark:hover:bg-slate-800"
        [ngClass]="router.isActive('/time-in-out', false)
          ? 'text-blue-600 dark:text-blue-400 font-semibold bg-blue-50 dark:bg-blue-950/30'
          : ''">
        <span class="w-6 flex justify-center"><i class="ni ni-time-alarm text-xl"></i></span>
        <span>Time in / Time out</span>
      </a>

      <a
        routerLink="/employee" routerLinkActive="active-link"
        class="flex items-center gap-3 px-4 py-2 rounded-lg transition nav-link
               hover:bg-gray-100 dark:hover:bg-slate-800"
        [ngClass]="router.isActive('/employee', false)
          ? 'text-blue-600 dark:text-blue-400 font-semibold bg-blue-50 dark:bg-blue-950/30'
          : ''">
        <span class="w-6 flex justify-center"><i class="ni ni-single-02 text-xl"></i></span>
        <span>Employee</span>
      </a>

      <a
        routerLink="/billing" routerLinkActive="active-link"
        class="flex items-center gap-3 px-4 py-2 rounded-lg transition nav-link
               hover:bg-gray-100 dark:hover:bg-slate-800"
        [ngClass]="router.isActive('/billing', false)
          ? 'text-blue-600 dark:text-blue-400 font-semibold bg-blue-50 dark:bg-blue-950/30'
          : ''">
        <span class="w-6 flex justify-center"><i class="ni ni-money-coins text-xl"></i></span>
        <span>Billing</span>
      </a>

      <a
        routerLink="/income" routerLinkActive="active-link"
        class="flex items-center gap-3 px-4 py-2 rounded-lg transition nav-link
               hover:bg-gray-100 dark:hover:bg-slate-800"
        [ngClass]="router.isActive('/income', false)
          ? 'text-blue-600 dark:text-blue-400 font-semibold bg-blue-50 dark:bg-blue-950/30'
          : ''">
        <span class="w-6 flex justify-center"><i class="ni ni-calendar-grid-58 text-xl"></i></span>
        <span>Income</span>
      </a>
      
      <a
        routerLink="/truck-detail"
        routerLinkActive="active-link"
        [routerLinkActiveOptions]="{ exact: true }"
        class="flex items-center gap-3 px-4 py-2 rounded-lg transition nav-link hover:bg-gray-100 dark:hover:bg-slate-800"
        [ngClass]="router.isActive('/truck-detail', false)
          ? 'text-blue-600 dark:text-blue-400 font-semibold bg-blue-50 dark:bg-blue-950/30'
          : ''">
        <span class="w-6 flex justify-center"><i class="ni ni-calendar-grid-58 text-xl"></i></span>
        <span>Truck Detail</span>
      </a>

      <a
        routerLink="/chat-call"
        routerLinkActive="active-link"
        [routerLinkActiveOptions]="{ exact: true }"
        class="flex items-center gap-3 px-4 py-2 rounded-lg transition nav-link hover:bg-gray-100 dark:hover:bg-slate-800"
        [ngClass]="router.isActive('/chat-call', false)
          ? 'text-blue-600 dark:text-blue-400 font-semibold bg-blue-50 dark:bg-blue-950/30'
          : ''">
        <span class="w-6 flex justify-center"><i class="ni ni-calendar-grid-58 text-xl"></i></span>
        <span>Chat Call</span>
      </a>
    </nav>

    <div class="mt-auto pt-6">
      <a
        (click)="logout()"
        class="flex items-center gap-2 font-medium text-sm px-4 py-2 rounded-lg transition
               text-purple-600 hover:text-purple-800 bg-purple-50 hover:bg-purple-100
               dark:text-purple-300 dark:hover:text-purple-200 dark:bg-slate-800 dark:hover:bg-slate-700 logout-btn">
        <span class="w-6 flex justify-center"><i class="ni ni-user-run text-lg"></i></span>
        <span>Log out</span>
      </a>
    </div>
  </aside>

  <!-- Content Area -->
  <main class="flex-1 flex items-center justify-center p-8 bg-transparent">
    <div
      class="w-full h-full rounded-3xl shadow-lg p-8 overflow-auto enhanced-content
             bg-white dark:bg-slate-900 text-slate-900 dark:text-slate-100
             border border-gray-100 dark:border-slate-800 ">
      <router-outlet></router-outlet>
    </div>
  </main>
</div>
